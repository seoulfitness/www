<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="userMapper">

    <resultMap id="userResultMap" type="kr.seoulfitness.user.UserDto">
        <result property="id" column="ID" />
        <result property="userId" column="USER_ID" />
        <result property="userName" column="USER_NAME" />
        <result property="userEmail" column="USER_EMAIL" />
        <result property="password" column="PASSWORD" />
        <result property="userPhone" column="USER_PHONE" />
        <result property="userProfileImage" column="USER_PROFILE_IMAGE" />
        <result property="userRole" column="USER_ROLE" />
        <result property="userStatus" column="USER_STATUS" />    
        <result property="deleteRequest" column="DELETE_REQUEST" />
        <result property="deleteRequestedAt" column="DELETE_REQUESTED_AT" />    
        <result property="createdAt" column="CREATED_AT" />
        <result property="updatedAt" column="UPDATED_AT" />
        <result property="createdBy" column="CREATED_BY" />
        <result property="updatedBy" column="UPDATED_BY" />        
    </resultMap>

    <!-- 사용자 등록 -->
    <insert id="create" parameterType="kr.seoulfitness.user.UserDto" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO USERS (
            USER_ID, 
            NAME, 
            EMAIL, 
            PASSWORD, 
            PHONE, 
            PROFILE_IMAGE, 
            ROLE, 
            STATUS
        ) VALUES (
            #{userId}, 
            #{name}, 
            #{email}, 
            #{password}, 
            #{phone}, 
            #{profileImage}, 
            #{role}, 
            #{status}
        )
    </insert>

    <!-- 사용자 보기 -->
    <select id="read" resultMap="userResultMap">
        <![CDATA[
        SELECT
            ID,
            USER_ID,
            NAME, 
            EMAIL, 
            PASSWORD, 
            PHONE, 
            PROFILE_IMAGE, 
            ROLE, 
            STATUS,
            DELETE_REQUEST,
            DELETE_REQUESTED_AT,
            CREATED_AT,
            UPDATED_AT,
            CREATED_BY,
            UPDATED_BY
        FROM
            USERS
        WHERE
            1 = 1
        ]]>
        <if test="id != null and id != 0">
            <![CDATA[
            AND ID = #{id}
            ]]>
        </if>
        <if test="userId != null">
            <![CDATA[
            AND USER_ID = #{userId}
            ]]>
        </if>
        <if test="name != null">
            <![CDATA[
            AND NAME = #{name}
            ]]>
        </if>
        <if test="phone != null">
            <![CDATA[
            AND PHONE = #{phone}
            ]]>
        </if>
        <if test="email != null">
            <![CDATA[
            AND EMAIL = #{email}
            ]]>
        </if>
        <if test="role != null">
            <![CDATA[
            AND ROLE = #{role}
            ]]>
        </if>        
    </select>

</mapper>
